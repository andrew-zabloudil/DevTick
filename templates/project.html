{% include "header.html" %}

<div class="flex-container flex-row">
  <div class="project-pane flex-container flex-col">
    <nav id="sub-nav">
      {% if is_creator(project.id) %}
       <a href="{{ url_for('edit_project', project_id=project.id) }}" class="nav-button">Edit Project</a>
      {% endif %}
      {% if is_editor(project.id) or is_admin(project.id) or is_creator(project.id) %}
        <a href="{{ url_for('create_ticket', project_id=project.id) }}" class="nav-button">Create Ticket</a>
      {% endif %}
      {% if is_admin(project.id) or is_creator(project.id) %}
        <a href="{{ url_for('add_user', project_id=project.id) }}" class="nav-button">Add User</a>
      {% endif %}
    </nav>
    <div class="project">
      <p class="project-name">{{ project.name }}</p>
      <p class="project-creator">Created by: <span>{{ project.creator.name }}</span></p>
      <p class="project-summary">{{ project.summary }}</p>
      <div class="project-desc">{{ project.description|safe }}</div>
      {% if project.invited_users %}
        <ul class="user-list">
          <p>Project Members:</p>
          <li class="user-list-items">
            <span>{{ project.creator.name }}</span>
            <span>Creator</span>
          </li>
          {% for user_role, users in project.invited_users|groupby("user_role") %}
            {% for user in users %}
              <li class="user-list-items">
                <span>{{ user.user.name }}</span>
                {% if is_creator(project.id) or is_admin(project.id) %}
                  <a href="{{ url_for('edit_user', project_id=project.id, user_id=user.user_id) }}">{{ user.user_role }}</a>
                  <a href="{{ url_for('remove_user', project_id=project.id, user_id=user.user_id) }}" class="nav-button warning">Remove User</a>
                {% else %}
                  <span>{{ user.user_role }}</span>
                {% endif %}
              </li>
            {% endfor %}
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>
  <div class="ticket-pane flex-container flex-row">
    {% if not project.tickets %}
      <p>This project has no tickets yet. Get started now by clicking Create Ticket!</p>
    {% else %}
      {% for category, tickets in project.tickets|groupby("category") %}
        <div class="{{ category.lower().replace(' ', '-') }} flex-container flex-col">
          <span>{{ category.capitalize() }}</span>
          {% for status, items in tickets|groupby("status")|reverse %}
            {% for ticket in items %}
              <div class="ticket">
                {% if not is_viewer(project.id) %}
                  <a href="{{ url_for('edit_ticket', project_id=project.id, ticket_id=ticket.id) }}" title="Edit Ticket"><i class="fas fa-edit edit-button"></i></a>
                {% endif %}
                <p class="{{ status.lower() }}">Ticket Name: {{ ticket.name }}</p>
                <p class="{{ status.lower() }}">Ticket Summary: {{ ticket.summary }}</p>
                <div class="{{ status.lower() }}">Ticket Description: {{ ticket.description|safe }}</div>
              </div>
            {% endfor %}
          {% endfor %}
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>


{% include "footer.html" %}
